import{r as o,j as t,b as d,B as u}from"./index-F5vbwB_e.js";import{A as G}from"./AddUserTable-BUffmWqP.js";import{C as Y}from"./Toast-3WOWCnnS.js";import{M as q,a as p}from"./Modal-DXZjyk5v.js";import{B as T}from"./Button-yCakRxFg.js";import{a as x}from"./Form-DX8VXhY2.js";import"./Table-Cvi54BG9.js";import"./TransitionWrapper-BBSR4vEj.js";import"./ThemeProvider-nWUV6F1R.js";import"./TablePlaceholder-yL1ruwTr.js";import"./hasClass-CHl0QHe7.js";import"./useTimeout-BGLe_eT-.js";import"./warning-BE2tzXYX.js";import"./Placeholder-sFQbI7v7.js";import"./Col-CGBuhqx3.js";function le(){document.title="CarrerCell | Approve Students";const[U,b]=o.useState([]),[k,f]=o.useState(!0),[D,a]=o.useState(!1),[z,n]=o.useState(""),[y,c]=o.useState(!1),[S,j]=o.useState(null),[I,v]=o.useState(""),[w,A]=o.useState(""),[i,B]=o.useState(null),[_,m]=o.useState(!1),[$,M]=o.useState(""),[h,P]=o.useState(null),s=h==="management_admin"?"management":h==="tpo_admin"?"tpo":null;o.useEffect(()=>{(async()=>{try{const r=await d.get(`${u}/user/detail`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});P(r.data.role)}catch(r){console.error("Error fetching current user role",r),f(!1)}})()},[]);const g=async()=>{if(!s){f(!1);return}try{const e=await d.get(`${u}/${s}/student-users`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(e.data){const r=e.data.studentUsers.filter(l=>{var E;return!((E=l.studentProfile)!=null&&E.isApproved)});b(r)}else console.warn("Response does not contain studentUsers:",e.data)}catch(e){console.error("Error fetching user details",e)}finally{f(!1)}};o.useEffect(()=>{s&&g()},[s]),o.useEffect(()=>{h&&!s&&f(!1)},[h,s]);const F=e=>{if(typeof e=="string"){j(e),v(`Do you want to delete ${e}?`),A("Delete"),c(!0);return}B(e),M(""),m(!0)},R=async()=>{if(s)try{const e=await d.post(`${u}/${s}/student-delete-user`,{email:S},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});c(!1),e.data&&(n(e.data.msg),a(!0),g())}catch(e){console.log("student => confirmDelete ==> ",e)}},C=()=>{c(!1),j(null)},L=e=>{j(e),v(`Do you want to approve ${e}?`),A("Approve"),c(!0)},H=async()=>{if(s)try{const e=await d.post(`${u}/${s}/student-approve`,{email:S},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});e.data&&(n(e.data.msg||"User approved successfully"),a(!0),g()),c(!1)}catch(e){n("Error approving user"),a(!0),console.log("handleApproveStudent => AddUersTable.jsx ==> ",e)}},N=async()=>{var e;if(!(!s||!i))try{const r={receiver_role:"student",receiver:i._id,title:"Application Status",message:$||"Your application was rejected."},l=await d.post(`${u}/${s}/send-notice`,r,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});m(!1),B(null),(e=l==null?void 0:l.data)!=null&&e.msg?(n(l.data.msg),a(!0)):(n("Rejection notice sent"),a(!0)),g()}catch(r){console.error("Error sending rejection notice",r),n("Error sending rejection notice"),a(!0)}};return t.jsxs(t.Fragment,{children:[t.jsx(Y,{show:D,onClose:()=>a(!1),message:z,delay:3e3,position:"bottom-end"}),t.jsx(G,{users:U,loading:k,handleDeleteUser:F,showModal:y,closeModal:C,confirmDelete:R,userToDelete:S,userToAdd:"approve-student",handleApproveStudent:L}),t.jsx(q,{show:y,close:C,header:"Confirmation",body:I,btn:w,confirmAction:w==="Delete"?R:H}),t.jsxs(p,{show:_,onHide:()=>m(!1),backdrop:"static",keyboard:!1,children:[t.jsx(p.Header,{closeButton:!0,children:t.jsx(p.Title,{children:"Send Rejection Notice"})}),t.jsxs(p.Body,{children:[t.jsxs("div",{className:"mb-2",children:["Send rejection notice to ",t.jsx("strong",{children:i==null?void 0:i.email})]}),t.jsxs(x.Group,{children:[t.jsx(x.Label,{children:"Message"}),t.jsx(x.Control,{as:"textarea",rows:4,value:$,onChange:e=>M(e.target.value),placeholder:"Enter rejection message to send to student"})]})]}),t.jsxs(p.Footer,{children:[t.jsx(T,{variant:"secondary",onClick:()=>m(!1),children:"Close"}),t.jsx(T,{variant:"danger",onClick:N,children:"Send"})]})]})]})}export{le as default};
