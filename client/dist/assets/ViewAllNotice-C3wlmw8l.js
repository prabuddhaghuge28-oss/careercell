import{r as d,b as n,B as x,j as t,L}from"./index-F5vbwB_e.js";import{B as C}from"./Badge-XAqEXOkL.js";import{T as A,O as E,a as $}from"./TablePlaceholder-yL1ruwTr.js";import{C as D}from"./Toast-3WOWCnnS.js";import{M as B}from"./Modal-DXZjyk5v.js";import{T as P}from"./Table-Cvi54BG9.js";import"./ThemeProvider-nWUV6F1R.js";import"./hasClass-CHl0QHe7.js";import"./TransitionWrapper-BBSR4vEj.js";import"./useTimeout-BGLe_eT-.js";import"./warning-BE2tzXYX.js";import"./Placeholder-sFQbI7v7.js";import"./Col-CGBuhqx3.js";import"./Button-yCakRxFg.js";function X(){document.title="CarrerCell | Notices";const[j,p]=d.useState(!0),[r,m]=d.useState([]),[s,u]=d.useState({}),[_,g]=d.useState(!1),[w,y]=d.useState(""),[c,i]=d.useState(!1),[N,S]=d.useState(""),T=()=>i(!1),v=e=>t.jsx($,{id:"button-tooltip",...e,children:"Delete Notice"});d.useEffect(()=>{(async()=>{try{const l=localStorage.getItem("token"),a=await n.get(`${x}/user/detail`,{headers:{Authorization:`Bearer ${l}`}});u({role:a.data.role})}catch(l){console.log("Error fetching user details => ",l)}})()},[]),d.useEffect(()=>{s!=null&&s.role&&f()},[s==null?void 0:s.role]);const b=async e=>{S(e),i(!0)},M=async e=>{var l;try{const a=await n.post(`${x}/management/delete-notice?noticeId=${e}`);(l=a==null?void 0:a.data)!=null&&l.msg&&(f(),y(a.data.msg),g(!0))}catch(a){console.log("Error while deleting notice => ",a)}i(!1)},f=async()=>{var e,l;try{const a=await n.get(`${x}/management/get-all-notices`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if((s==null?void 0:s.role)==="tpo_admin"){const h=(e=a==null?void 0:a.data)==null?void 0:e.filter(o=>o.sender_role==="tpo_admin"||o.receiver_role==="tpo_admin");m(h)}else if((s==null?void 0:s.role)==="student"){const h=(l=a==null?void 0:a.data)==null?void 0:l.filter(o=>o.receiver_role==="student");m(h)}else m(a.data)}catch(a){console.log("Error while fetching notices => ",a)}finally{p(!1)}};return t.jsxs(t.Fragment,{children:[t.jsx(D,{show:_,onClose:()=>g(!1),message:w,delay:3e3,position:"bottom-end"}),j?t.jsx(A,{}):t.jsx(t.Fragment,{children:t.jsx("div",{className:"",children:t.jsxs(P,{striped:!0,bordered:!0,hover:!0,className:"bg-white my-6 rounded-lg shadow w-full text-base max-sm:text-sm",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{style:{width:"2%"},children:"#"}),t.jsx("th",{style:{width:"20%"},children:"Title"}),(s==null?void 0:s.role)!=="student"&&t.jsxs(t.Fragment,{children:[t.jsx("th",{style:{width:"10%"},children:"Sender Role"}),t.jsx("th",{style:{width:"10%"},children:"Receiver Role"})]}),t.jsx("th",{style:{width:"40%"},children:"Message"}),t.jsx("th",{style:{width:"18%"},children:"Time Posted"}),(s==null?void 0:s.role)!=="student"&&t.jsx("th",{style:{width:"5%"},children:"Action"})]})}),t.jsx("tbody",{children:(r==null?void 0:r.length)>0?r==null?void 0:r.map((e,l)=>t.jsxs("tr",{children:[t.jsx("td",{children:l+1}),t.jsx("td",{children:t.jsxs(L,{to:(s==null?void 0:s.role)==="student"?`/student/notice/${e==null?void 0:e._id}`:(s==null?void 0:s.role)==="tpo_admin"?`/tpo/notice/${e==null?void 0:e._id}`:s.role==="management_admin"?`/management/notice/${e==null?void 0:e._id}`:"",className:"no-underline text-blue-500 hover:text-blue-700",children:[e==null?void 0:e.title,(new Date-new Date(e==null?void 0:e.createdAt))/(1e3*60*60*24)<=2&&t.jsx(C,{className:"mx-2",bg:"primary",children:"New"})]})}),(s==null?void 0:s.role)!=="student"&&t.jsxs(t.Fragment,{children:[t.jsxs("td",{children:[(e==null?void 0:e.sender_role)==="management_admin"&&"Management",(e==null?void 0:e.sender_role)==="tpo_admin"&&"TPO",(e==null?void 0:e.sender_role)==="system"&&"System",(e==null?void 0:e.sender_role)==="student"&&"Student"]}),t.jsxs("td",{children:[(e==null?void 0:e.receiver_role)==="tpo_admin"&&"TPO",(e==null?void 0:e.receiver_role)==="management_admin"&&"Management",(e==null?void 0:e.receiver_role)==="student"&&"Student"]})]}),t.jsx("td",{children:e==null?void 0:e.message}),t.jsxs("td",{children:[new Date(e.createdAt).toLocaleDateString("en-IN")+" ",t.jsx("span",{className:"text-gray-500",children:new Date(e.createdAt).toLocaleTimeString("en-IN")})]}),(s==null?void 0:s.role)!=="student"&&((s==null?void 0:s.role)==="tpo_admin"&&(e==null?void 0:e.sender_role)!=="management_admin"||(s==null?void 0:s.role)==="management_admin"?t.jsx(t.Fragment,{children:t.jsx("td",{children:t.jsx("div",{className:"flex justify-around items-center",children:t.jsx(E,{placement:"top",delay:{show:250,hide:400},overlay:v,children:t.jsx("i",{className:"fa-regular fa-trash-can text-2xl cursor-pointer hover:text-red-500",onClick:()=>b(e._id),onMouseEnter:a=>{a.target.classList.remove("fa-regular"),a.target.classList.add("fa-solid")},onMouseLeave:a=>{a.target.classList.remove("fa-solid"),a.target.classList.add("fa-regular")}})})})})}):t.jsx("td",{className:"text-center",children:"-"}))]},e==null?void 0:e._id)):t.jsx("tr",{children:t.jsx("td",{colSpan:(s==null?void 0:s.role)!=="student"?"7":"5",children:"No notices found!"})})})]})})}),t.jsx(B,{show:c,close:T,header:"Confirmation",body:"Want to delete notice?",btn:"Delete",confirmAction:()=>M(N)})]})}export{X as default};
