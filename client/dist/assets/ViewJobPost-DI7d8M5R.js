import{c as q,r as c,b as f,B as b,j as e,L as G}from"./index-F5vbwB_e.js";import{A as p}from"./Accordion-Czl0Iohf.js";import{T as Q}from"./Table-Cvi54BG9.js";import{C as X}from"./Toast-3WOWCnnS.js";import{B as y}from"./Button-yCakRxFg.js";import{M as Z}from"./Modal-DXZjyk5v.js";import"./ThemeProvider-nWUV6F1R.js";import"./TransitionWrapper-BBSR4vEj.js";import"./useTimeout-BGLe_eT-.js";import"./hasClass-CHl0QHe7.js";function ce(){var $;document.title="CarrerCell | View Job Post";const{jobId:m}=q(),[o,C]=c.useState({}),[a,k]=c.useState(null),[D,L]=c.useState(!0),[B,u]=c.useState(!1),[T,h]=c.useState(""),[d,I]=c.useState({}),[_,w]=c.useState(!1),[g,E]=c.useState([]),N=async()=>{var t,s,i,n,x;try{const l=await f.get(`${b}/student/check-applied/${m}/${d.id}`);(t=l==null?void 0:l.data)!=null&&t.applied&&w((s=l==null?void 0:l.data)==null?void 0:s.applied)}catch(l){(n=(i=l==null?void 0:l.response)==null?void 0:i.data)!=null&&n.msg&&(h((x=response==null?void 0:response.data)==null?void 0:x.msg),u(!0)),console.log("error while fetching student applied or not => ",l)}};c.useEffect(()=>{const t=localStorage.getItem("token");f.get(`${b}/user/detail`,{headers:{Authorization:`Bearer ${t}`}}).then(s=>{I({id:s.data.id,email:s.data.email,role:s.data.role})}).catch(s=>{console.log("AddUserTable.jsx => ",s),h(s),u(!0)})},[]);const M=async()=>{var t,s,i;try{const n=await f.get(`${b}/tpo/job/${m}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});C(n.data)}catch(n){n.response&&((t=n==null?void 0:n.response.data)!=null&&t.msg?h(n.response.data.msg):h(n.message),u(!0),((i=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:i.msg)==="job data not found"&&navigate("../404")),console.log("Error while fetching details => ",n)}},R=async()=>{try{const t=await f.get(`${b}/company/company-data?companyId=${o.company}`);k(t.data.company)}catch(t){console.log("AddCompany error while fetching => ",t)}},[H,j]=c.useState(!1),[z,v]=c.useState(),[J,A]=c.useState(()=>()=>{}),[F,S]=c.useState("Apply"),K=()=>{j(!1)},O=()=>{v("Do you really want to apply this job? Make sure your profile is updated to lastest that increase placement chances."),S("Apply"),A(()=>U),j(!0)},U=async()=>{var t,s,i,n,x;try{const l=await f.put(`${b}/student/job/${m}/${d.id}`);(t=l==null?void 0:l.data)!=null&&t.msg&&(h((s=l==null?void 0:l.data)==null?void 0:s.msg),u(!0)),j(!1),N()}catch(l){j(!1),(n=(i=l==null?void 0:l.response)==null?void 0:i.data)!=null&&n.msg&&(h((x=response==null?void 0:response.data)==null?void 0:x.msg),u(!0)),console.log("error while fetching apply to job => ",l)}},V=()=>{v("Do you really want to withdraw your application for this job? This action will remove your application."),S("Reject"),A(()=>P),j(!0)},P=async()=>{var t,s,i,n,x,l;try{const r=await f.delete(`${b}/student/job/${m}/${d.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});(t=r==null?void 0:r.data)!=null&&t.msg&&(h((s=r==null?void 0:r.data)==null?void 0:s.msg),u(!0)),j(!1),w(!1)}catch(r){j(!1),(n=(i=r==null?void 0:r.response)==null?void 0:i.data)!=null&&n.msg&&(h((l=(x=r==null?void 0:r.response)==null?void 0:x.data)==null?void 0:l.msg),u(!0)),console.log("error while withdrawing application => ",r)}},W=async()=>{!m||(d==null?void 0:d.role)==="student"||await f.get(`${b}/tpo/job/applicants/${m}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(t=>{var s,i;(s=t==null?void 0:t.data)!=null&&s.msg?h(t.data.msg):E((i=t==null?void 0:t.data)==null?void 0:i.applicantsList)}).catch(t=>{var s,i;console.log(t),(i=(s=t==null?void 0:t.response)==null?void 0:s.data)!=null&&i.msg&&h(t.response.data.msg)})},Y=async()=>{var t,s;try{const i=await f.get(`${b}/tpo/job/applicants/${m}/export`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},responseType:"blob"}),n=new Blob([i.data],{type:"text/csv"}),x=window.URL.createObjectURL(n),l=document.createElement("a");l.href=x,l.setAttribute("download",`applicants_job_${m}.csv`),document.body.appendChild(l),l.click(),l.parentNode.removeChild(l),window.URL.revokeObjectURL(x)}catch(i){console.log("Error exporting CSV => ",i),(s=(t=i==null?void 0:i.response)==null?void 0:t.data)!=null&&s.msg?(h(i.response.data.msg),u(!0)):(h("Failed to export CSV"),u(!0))}};return c.useEffect(()=>{(async()=>{try{await N(),o!=null&&o.company&&await R(),d.id&&await M(),m&&await W()}catch(s){console.error("Error during fetching and applying job:",s)}L(!1)})()},[d.id,o==null?void 0:o.company,m]),e.jsxs(e.Fragment,{children:[e.jsx(X,{show:B,onClose:()=>u(!1),message:T,delay:3e3,position:"bottom-end"}),D?e.jsx("div",{className:"flex justify-center h-72 items-center",children:e.jsx("i",{className:"fa-solid fa-spinner fa-spin text-3xl"})}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 my-6 text-base max-sm:text-sm max-sm:grid-cols-1",children:[e.jsxs("div",{className:"flex flex-col grid-flow-row-dense gap-2",children:[e.jsx("div",{className:"",children:e.jsx(p,{defaultActiveKey:["0"],alwaysOpen:!0,className:"shadow rounded",children:e.jsxs(p.Item,{eventKey:"0",children:[e.jsx(p.Header,{children:"Company Details"}),e.jsx(p.Body,{children:e.jsxs("div",{className:"",children:[e.jsx("h3",{className:"text-3xl text-center border-b-2 py-4 mb-4",children:a==null?void 0:a.companyName}),e.jsx("div",{className:"border-b-2 px-2 pb-4 text-gray-500 text-justify leading-5",children:a==null?void 0:a.companyDescription}),e.jsxs("div",{className:"flex justify-between p-2 border-b-2 my-2",children:[e.jsx("span",{children:"Website"}),e.jsx("span",{className:"bg-blue-500 py-1 px-2 text-white rounded cursor-pointer",children:e.jsx("a",{href:`${a==null?void 0:a.companyWebsite}`,target:"_blanck",className:"no-underline text-white",children:a==null?void 0:a.companyWebsite})})]}),e.jsxs("div",{className:"flex justify-between p-2 border-b-2 my-2",children:[e.jsx("span",{children:"Job Locations"}),e.jsx("div",{className:"flex gap-2",children:($=a==null?void 0:a.companyLocation)==null?void 0:$.split(",").map((t,s)=>e.jsx("span",{className:"bg-blue-500 py-1 px-2 text-white rounded",children:t.trim()},s))})]}),e.jsxs("div",{className:"flex justify-between p-2 border-b-2 my-2",children:[e.jsx("span",{children:"Difficulty Level"}),(a==null?void 0:a.companyDifficulty)==="Easy"&&e.jsx("span",{className:"bg-green-500 py-1 px-2 text-white rounded",children:a==null?void 0:a.companyDifficulty}),(a==null?void 0:a.companyDifficulty)==="Moderate"&&e.jsx("span",{className:"bg-orange-500 py-1 px-2 text-white rounded",children:a==null?void 0:a.companyDifficulty}),(a==null?void 0:a.companyDifficulty)==="Hard"&&e.jsx("span",{className:"bg-red-500 py-1 px-2 text-white rounded",children:a==null?void 0:a.companyDifficulty})]})]})})]})})}),d.role!=="student"&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"",children:e.jsx(p,{defaultActiveKey:["3"],alwaysOpen:!0,className:"shadow rounded",children:e.jsxs(p.Item,{eventKey:"3",children:[e.jsx(p.Header,{children:"Applicants Applied"}),e.jsxs(p.Body,{children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsxs(y,{variant:"info",size:"sm",onClick:Y,children:[e.jsx("i",{className:"fa-solid fa-file-csv mr-2"}),"Export CSV"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Q,{striped:!0,bordered:!0,hover:!0,size:"sm",className:"text-center min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"10%"},children:"#"}),e.jsx("th",{style:{width:"30%"},children:"Name"}),e.jsx("th",{style:{width:"30%"},children:"Email"}),e.jsx("th",{style:{width:"30%"},children:"Applied On"})]})}),e.jsx("tbody",{children:(g==null?void 0:g.length)>0?e.jsx(e.Fragment,{children:g.map((t,s)=>e.jsxs("tr",{children:[e.jsx("td",{children:s+1}),e.jsx("td",{children:(d.role==="tpo_admin"||d.role==="management_admin")&&e.jsx(G,{to:d.role==="tpo_admin"?`/tpo/user/${t.id}`:d.role==="management_admin"?`/management/user/${t.id}`:"#",target:"_blank",className:"text-blue-500 no-underline hover:text-blue-700",children:t.name})}),e.jsx("td",{children:t.email}),e.jsx("td",{children:new Date(t.appliedAt).toLocaleString("en-IN")})]},s))}):e.jsx("tr",{children:e.jsx("td",{colSpan:5,children:"No Student Yet Applied!"})})})]})})]})]})})})})]}),e.jsx("div",{className:"",children:e.jsx(p,{defaultActiveKey:["1"],alwaysOpen:!0,className:"shadow rounded",children:e.jsxs(p.Item,{eventKey:"1",children:[e.jsx(p.Header,{children:"Job Details"}),e.jsx(p.Body,{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col backdrop-blur-md bg-white/30 border border-white/20 rounded-lg px-2 shadow-sm shadow-red-400",children:[e.jsx("span",{className:"text-xl text-blue-500 py-2 border-b-2",children:"Job Title"}),e.jsx("span",{className:"py-3",children:o==null?void 0:o.jobTitle})]}),e.jsxs("div",{className:"flex flex-col backdrop-blur-md bg-white/30 border border-white/20 rounded-lg px-2 shadow-sm shadow-red-400",children:[e.jsx("span",{className:"text-xl text-blue-500 py-2 border-b-2",children:"Job Profile"}),e.jsx("span",{className:"py-3",dangerouslySetInnerHTML:{__html:o==null?void 0:o.jobDescription}})]}),e.jsxs("div",{className:"flex flex-col backdrop-blur-md bg-white/30 border border-white/20 rounded-lg px-2 shadow-sm shadow-red-400",children:[e.jsx("span",{className:"text-xl text-blue-500 py-2 border-b-2",children:"Eligibility"}),e.jsx("span",{className:"py-3",dangerouslySetInnerHTML:{__html:o==null?void 0:o.eligibility}})]}),e.jsxs("div",{className:"flex flex-col backdrop-blur-md bg-white/30 border border-white/20 rounded-lg px-2 shadow-sm shadow-red-400",children:[e.jsx("span",{className:"text-xl text-blue-500 py-2 border-b-2",children:"Annual CTC"}),e.jsxs("span",{className:"py-3",children:[o==null?void 0:o.salary," LPA"]})]}),e.jsxs("div",{className:"flex flex-col backdrop-blur-md bg-white/30 border border-white/20 rounded-lg px-2 shadow-sm shadow-red-400",children:[e.jsx("span",{className:"text-xl text-blue-500 py-2 border-b-2",children:"Last Date of Application"}),e.jsx("span",{className:"py-3",children:new Date(o==null?void 0:o.applicationDeadline).toLocaleDateString("en-IN",{month:"long",year:"numeric",day:"numeric"})})]}),e.jsxs("div",{className:"flex flex-col backdrop-blur-md bg-white/30 border border-white/20 rounded-lg px-2 shadow-sm shadow-red-400",children:[e.jsx("span",{className:"text-xl text-blue-500 py-2 border-b-2",children:"How to Apply?"}),e.jsx("span",{className:"py-3",dangerouslySetInnerHTML:{__html:o==null?void 0:o.howToApply}})]}),d.role==="student"&&e.jsx("div",{className:"flex justify-center mt-4 gap-2",children:_===!1?e.jsxs(y,{variant:"warning",onClick:O,children:[e.jsx("i",{className:"fa-solid fa-check px-2"}),"Apply Now"]}):e.jsx(e.Fragment,{children:e.jsxs(y,{variant:"danger",onClick:V,children:[e.jsx("i",{className:"fa-solid fa-x px-2"}),"Reject"]})})})]})})]})})})]})}),e.jsx(Z,{show:H,close:K,header:"Confirmation",body:z,btn:F,confirmAction:J})]})}export{ce as default};
