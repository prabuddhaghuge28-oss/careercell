import{u as T,r as t,b as p,B as f,j as e}from"./index-F5vbwB_e.js";import{B as E}from"./Button-yCakRxFg.js";import{F as d,a as m}from"./Form-DX8VXhY2.js";import{C as B}from"./Toast-3WOWCnnS.js";import{M as F}from"./Modal-DXZjyk5v.js";import"./ThemeProvider-nWUV6F1R.js";import"./useTimeout-BGLe_eT-.js";import"./TransitionWrapper-BBSR4vEj.js";import"./warning-BE2tzXYX.js";import"./Col-CGBuhqx3.js";import"./hasClass-CHl0QHe7.js";function P(){document.title="CarrerCell | Send Notice";const i=T(),[j,u]=t.useState(!0),[o,g]=t.useState({}),[h,v]=t.useState(""),[s,S]=t.useState({role:"",id:""}),[b,x]=t.useState(!1),[N,y]=t.useState(""),[C,r]=t.useState(!1),_=()=>r(!1);t.useEffect(()=>{const a=localStorage.getItem("token");if(!a){i("/login");return}p.get(`${f}/user/detail`,{headers:{Authorization:`Bearer ${a}`}}).then(n=>{S({id:n.data.id,role:n.data.role}),u(!1)}).catch(n=>{console.log("SendNotice.jsx => ",n),i("/login")})},[i]);const c=a=>g({...o,[a.target.name]:a.target.value}),M=()=>{if(!(o!=null&&o.receiver_role)||!(o!=null&&o.title)||!(o!=null&&o.message)){v("All Fields Required!");return}r(!0)},w=async()=>{var a,n;try{const l=await p.post(`${f}/management/send-notice`,o,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});(a=l==null?void 0:l.data)!=null&&a.msg&&(y((n=l==null?void 0:l.data)==null?void 0:n.msg),x(!0)),i((s==null?void 0:s.role)==="management_admin"?"/management/all-notice":"/tpo/all-notice")}catch(l){console.log("Error while sending notice: ",l)}r(!1)};return t.useEffect(()=>{s!=null&&s.role&&(s!=null&&s.id)&&g(a=>({...a,sender:s==null?void 0:s.id,sender_role:s==null?void 0:s.role}))},[s]),e.jsxs(e.Fragment,{children:[e.jsx(B,{show:b,onClose:()=>x(!1),message:N,delay:3e3,position:"bottom-end"}),j?e.jsx("div",{className:"flex justify-center h-72 items-center",children:e.jsx("i",{className:"fa-solid fa-spinner fa-spin text-3xl"})}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"my-8 backdrop-blur-md bg-white/30 border border-white/20 rounded-lg shadow shadow-red-400 p-6 max-sm:text-sm max-sm:p-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[((s==null?void 0:s.role)==="management_admin"||(s==null?void 0:s.role)==="tpo_admin")&&e.jsx(d,{controlId:"floatingSendTo",label:e.jsxs("span",{children:["Receiver Role ",e.jsx("span",{style:{color:"red"},children:"*"})]}),children:e.jsxs(m.Select,{"aria-label":"Floating label select send to",className:"cursor-pointer",name:"receiver_role",value:(o==null?void 0:o.receiver_role)||"",onChange:c,children:[e.jsx("option",{disabled:!0,value:"",className:"text-gray-400",children:"Select Receiver Role..."}),e.jsx("option",{value:"student",children:"Student"}),(s==null?void 0:s.role)==="management_admin"&&e.jsx("option",{value:"tpo_admin",children:"TPO"}),(s==null?void 0:s.role)==="tpo_admin"&&e.jsx("option",{value:"management_admin",children:"Management"})]})}),e.jsx(d,{controlId:"floatingTitle",label:e.jsxs("span",{children:["Title ",e.jsx("span",{style:{color:"red"},children:"*"})]}),className:(s==null?void 0:s.role)==="tpo_admin"?"col-span-2":"",children:e.jsx(m.Control,{type:"text",placeholder:"Title",name:"title",value:(o==null?void 0:o.title)||"",onChange:c})}),e.jsx("div",{className:"col-span-2",children:e.jsx(d,{controlId:"floatingMessage",label:e.jsxs("span",{children:["Message ",e.jsx("span",{style:{color:"red"},children:"*"})]}),children:e.jsx(m.Control,{as:"textarea",placeholder:"Message",name:"message",style:{maxHeight:"250px",height:"200px"},value:(o==null?void 0:o.message)||"",onChange:c})})})]}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:"text-center text-red-500",children:h&&h})})]}),e.jsx("div",{className:"flex flex-col justify-center items-center gap-2",children:e.jsxs(E,{variant:"primary",size:"lg",onClick:M,onMouseEnter:a=>{a.target.querySelector("i").classList.add("fa-solid","fa-bounce")},onMouseLeave:a=>{a.target.querySelector("i").classList.remove("fa-solid","fa-bounce")},children:[e.jsx("i",{className:"fa-regular fa-paper-plane mr-2"}),"Send"]})})]})}),e.jsx(F,{show:C,close:_,header:"Confirmation",body:`Sending Notice ${o!=null&&o.message?`"${o==null?void 0:o.message}"`:""} to ${(o==null?void 0:o.receiver_role)||"student"}?`,btn:"Send",confirmAction:w})]})}export{P as default};
