import{u as B,a as V,r as n,b as f,B as g,j as e}from"./index-F5vbwB_e.js";import{T as G}from"./Table-Cvi54BG9.js";import{P as $}from"./Placeholder-sFQbI7v7.js";import{T as H,O as w,a as v}from"./TablePlaceholder-yL1ruwTr.js";import{M as K}from"./Modal-DXZjyk5v.js";import{C as Q}from"./Toast-3WOWCnnS.js";import"./TransitionWrapper-BBSR4vEj.js";import"./ThemeProvider-nWUV6F1R.js";import"./Col-CGBuhqx3.js";import"./Button-yCakRxFg.js";import"./hasClass-CHl0QHe7.js";import"./useTimeout-BGLe_eT-.js";import"./warning-BE2tzXYX.js";function le(){document.title="CareerCell | Job Listings";const y=B(),E=V(),[_,T]=n.useState(!0),[c,A]=n.useState([]),[P,D]=n.useState({}),[p,j]=n.useState(null),[k,d]=n.useState(!1),[J,x]=n.useState(""),[L,N]=n.useState(!1),[I,S]=n.useState(null),[o,F]=n.useState({cmpName:"",jbTitle:""});n.useEffect(()=>{const t=localStorage.getItem("token");f.get(`${g}/user/detail`,{headers:{Authorization:`Bearer ${t}`}}).then(s=>{j({id:s.data.id,email:s.data.email,role:s.data.role}),C()}).catch(s=>{console.log("Error in fetching user details => ",s),x(s.message||"Error loading user data"),d(!0)})},[]);const C=async()=>{var t,s;try{const a=await f.get(`${g}/tpo/jobs`);A(a.data.data),U(a.data.data)}catch(a){console.log("Error fetching jobs ",a),(s=(t=a==null?void 0:a.response)==null?void 0:t.data)!=null&&s.msg&&(x(a.response.data.msg),d(!0))}},U=async t=>{const s={};for(const a of t)if(a.company&&!s[a.company])try{const r=await f.get(`${g}/company/company-data?companyId=${a.company}`);s[a.company]=r.data.company.companyName}catch(r){console.log("Error fetching company name => ",r)}D(s),T(!1)},z=(t,s,a)=>{S(t),F({cmpName:s,jbTitle:a}),N(!0)},O=async t=>{var s,a,r,u,m,l;try{const i=localStorage.getItem("token"),h=await f.post(`${g}/tpo/delete-job`,{jobId:t},{headers:{Authorization:`Bearer ${i}`}});N(!1),C(),(s=h==null?void 0:h.data)!=null&&s.msg&&(x((a=h==null?void 0:h.data)==null?void 0:a.msg),d(!0))}catch(i){(u=(r=i==null?void 0:i.response)==null?void 0:r.data)!=null&&u.msg&&(x((l=(m=i==null?void 0:i.response)==null?void 0:m.data)==null?void 0:l.msg),d(!0)),console.log("Error deleting job ",i)}},R=()=>{N(!1),S(null)},{showToastPass:M,toastMessagePass:q}=E.state||{showToastPass:!1,toastMessagePass:""};return n.useEffect(()=>{M&&(x(q),d(M),y(".",{replace:!0,state:{}})),c||T(!1)},[]),e.jsxs(e.Fragment,{children:[e.jsx(Q,{show:k,onClose:()=>d(!1),message:J,delay:3e3,position:"bottom-end"}),e.jsx("div",{className:"",children:_||!p?e.jsx(H,{}):e.jsx("div",{className:"overflow-x-auto max-sm:text-sm max-sm:p-1",children:e.jsx("div",{className:"table-scrollbar",children:e.jsxs(G,{striped:!0,bordered:!0,hover:!0,className:"bg-white my-6 rounded-lg shadow w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Sr. No."}),e.jsx("th",{children:e.jsx("b",{children:"Company Name"})}),e.jsx("th",{children:"Job Title"}),e.jsx("th",{children:"Annual CTC"}),e.jsx("th",{children:"Last date of Application"}),e.jsx("th",{children:"No. of Students Applied"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:(c==null?void 0:c.length)>0?c==null?void 0:c.map((t,s)=>{var r,u;const a=(r=t==null?void 0:t.applicants)==null?void 0:r.find(m=>m.studentId==p.id);return e.jsxs("tr",{className:`${a?"table-success":""}`,children:[e.jsx("td",{children:s+1}),e.jsx("td",{children:e.jsx("b",{children:P[t==null?void 0:t.company]||e.jsx($,{as:"p",animation:"glow",children:e.jsx($,{xs:12})})})}),e.jsx("td",{children:t==null?void 0:t.jobTitle}),e.jsx("td",{children:t==null?void 0:t.salary}),e.jsx("td",{children:new Date(t==null?void 0:t.applicationDeadline).toLocaleDateString("en-In")}),e.jsx("td",{children:(u=t==null?void 0:t.applicants)==null?void 0:u.length}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-around items-center",children:[e.jsx("div",{className:"px-0.5",children:e.jsx(w,{placement:"top",delay:{show:250,hide:400},overlay:e.jsx(v,{children:"View Post"}),children:e.jsx("i",{className:"fa-solid fa-circle-info text-2xl max-sm:text-lg cursor-pointer transition-colors duration-200 ease-in-out hover:text-blue-500",onClick:()=>{const l={tpo_admin:`../tpo/job/${t._id}`,management_admin:`../management/job/${t._id}`,student:`../student/job/${t._id}`}[p.role];l&&y(l)}})})}),p.role==="tpo_admin"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-0.5",children:e.jsx(w,{placement:"top",delay:{show:250,hide:400},overlay:e.jsx(v,{children:"Edit Post"}),children:e.jsx("i",{className:"fa-regular fa-pen-to-square text-2xl max-sm:text-lg cursor-pointer transition-colors duration-200 ease-in-out hover:text-green-500 hover:fa-solid",onClick:()=>{const l={tpo_admin:`../tpo/post-job/${t._id}`}[p.role];l&&y(l)}})})}),e.jsx("div",{className:"px-0.5",children:e.jsx(w,{placement:"top",delay:{show:250,hide:400},overlay:e.jsx(v,{children:"Delete Post"}),children:e.jsx("i",{className:"fa-regular fa-trash-can text-2xl max-sm:text-lg cursor-pointer transition-colors duration-200 ease-in-out hover:text-red-500 hover:fa-solid",onClick:()=>z(t==null?void 0:t._id,P[t==null?void 0:t.company],t==null?void 0:t.jobTitle)})})})]})]})})]},t==null?void 0:t._id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center",children:"No Job Posts Found!"})})})]})})})}),e.jsx(K,{show:L,close:R,header:`Confirm Delete ${o==null?void 0:o.cmpName}`,body:e.jsxs(e.Fragment,{children:["Are you sure you want to delete this post of ",e.jsx("b",{children:o==null?void 0:o.jbTitle})," from ",o==null?void 0:o.cmpName,"?"]}),btn:"Delete",confirmAction:()=>O(I)})]})}export{le as default};
